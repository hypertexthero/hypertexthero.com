<!DOCTYPE html>
<html dir="ltr" lang="en-US">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="robots" content="all">
<meta http-equiv="imagetoolbar" content="false">
<meta name="MSSmartTagsPreventParsing" content="true">
<meta name="google-site-verification" content="CvLKcJBPrtNY455YaUc8M30eCw8V1ITHJEmg1l-mX9U" />
<meta name="keywords" content="django, nginx, fcgi, textdrive, deployment">

<meta name="author" content="Simon Griffee">
<meta name="copyright" content="Copyright 2001-2014 Simon Griffee.">

<!-- https://indieauth.com/setup -->
<link href="https://github.com/hypertexthero" rel="me">

<link rel="Shortcut Icon" href="/static/favicon.ico" type="image/x-icon">

<link rel="alternate" type="application/atom+xml" title="Atom Feed" href="http://hypertexthero.com/logbook/atom/">
<link rel="alternate" type="application/rss+xml" title="RSS Feed" href="http://hypertexthero.com/logbook/rss/">

<link href='http://fonts.googleapis.com/css?family=Gentium+Basic:400,400italic,700' rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="/static/css/hypertexthero.css" type="text/css">
<link rel="stylesheet" href="/static/css/code.css" type="text/css">





<!--[if lte IE 6]>
<link rel="stylesheet" type="text/css" media="screen" href="/static/css/ie6.css" />
<![endif]-->

<!--[if IE 7]>
<link rel="stylesheet" type="text/css" media="screen" href="/static/css/ie7.css" />
<![endif]-->



<title>
    Textdrive Server Deployment with Nginx via FastCGI -  Hypertexthero 
</title>
</head>

<body id="logbook" class="detail">

    
<div id="wrapper">
<div id="page">
  <div id="header">
    
  <div class="nav">
  <a id="loglogo" href="/" title="Hypertexthero homepage."><img src="/static/img/logo.png"></a>
  <ul>
      <li><a class="nav-home" href="/" title="Hypertexthero homepage.">Hypertexthero</a></li> 
      <li><a class="nav-logbook" href="/logbook/" title="Hypertexthero's blog on web, design and simplicity, also known as the Logbook.">Blog</a>, <a class="nav-archive" href="/archive/" title="Archive of original blog entries.">Archive</a></li>
      <li><a class="nav-work" href="/work/" title="Work examples.">Projects</a></li> 
      <li><a class="nav-contact" href="/contact/" title="Call Hypertexthero.">Contact</a></li>
  </ul>
</div>
    <p class="breadcrumbs"><a href="/" title="Hypertexthero homepage.">Hypertexthero</a> / <a href="/logbook/">Logbook</a> /</p>

  </div>

  <div id="content">
    


 

		<h1><a href="/logbook/2013/05/textdrive-server-deployment-nginx-fastcgi/" rel="permalink" title="Permanent link to this entry.">Textdrive Server Deployment with Nginx via FastCGI</a></h1>
		<p class="quiet"><time pubdate="pubdate">Sunday, May 5 2013</time></p>
		<p>My notes on deploying a Django application (this website) on Textdrive shared hosting with Nginx via <a href="https://docs.djangoproject.com/en/dev/howto/deployment/fastcgi/">FastCGI</a>.</p>
<p>Thanks to <a href="http://ecarmi.org/writing/django-on-joyent/">Evan Carmi</a>, who much of this is paraphrased from, and <a href="http://tumunu.com/">Pokoka</a> who has far more knowledge on system administration than I, and <a href="http://discuss.textdrive.com/viewtopic.php?id=531">has an alternate method using uWSGI</a> and a <a href="https://github.com/Tumunu/txd">handy script</a>.</p>
<h2>Search and&nbsp;Replace</h2>
<p>yourusername<br>
yourdomain.tld<br>
yourproject<br>
yourportnumber<br></p>
<h2>Server folder&nbsp;layout</h2>
<div class="codehilite"><pre>yourusername
    domains
        yourdomain.tld
            .virtualenv     &lt;- virtual environment
                yourproject
                    bin
                    include
                    lib
                        python2.7/site-packages     &lt;- where django and packages installed with pip go
                    src
            etc
                nginx
                    sites-enabled
                        nginx.conf    &lt;- nginx config file (=todo:create symlink from here to web/yourproject/yourproject/conf below)
            web
                yourproject
                    yourproject     &lt;- django project git repository cloned from github
                    init.sh     &lt;- fcgi startup script. don&#39;t forget to make executable with chmod +x init.sh
                    manage.py
            public
                static   &lt;- static files - either create symlink from here to project repo or run python manage.py collectstatic
                static/files  &lt;- static files uploaded by users of your app
                static/@admin  &lt;- django admin media symlink
</pre></div>


<h2><span class="caps">SSH</span> into your Txd&nbsp;server</h2>
<div class="codehilite"><pre><span class="nv">$ </span>ssh yourusername@yourserver.textdrive.us
</pre></div>


<h2>Install&nbsp;virtualenv</h2>
<div class="codehilite"><pre><span class="nv">$ </span>mkdir -p <span class="nb">local</span>/
<span class="nv">$ </span><span class="nb">cd local</span>/
<span class="nv">$ </span>wget -O virtualenv-1.9.1.tar.gz http://pypi.python.org/packages/source/v/virtualenv/virtualenv-1.9.1.tar.gz
<span class="nv">$ </span>tar xzvf virtualenv-1.9.1.tar.gz
</pre></div>


<p>Let’s now create our virtualenv on our server. This is the same as on our local&nbsp;machine:</p>
<div class="codehilite"><pre><span class="nv">$ </span>python virtualenv.py --no-site-packages ~/domains/yourdomain.tld/.virtualenv/yourproject
<span class="nv">$ </span><span class="nb">cd</span> ~/domains/yourdomain.tld/.virtualenv/yourproject
<span class="nv">$ </span>. bin/activate
</pre></div>


<h2>Setup the server’s&nbsp;virtualenv</h2>
<p>Create a symbolic link called &#8216;yourproject&#8217; in <code>~/domains/yourdomain.tld/.virtualenv/yourproject/lib/python2.7/site-packages</code>:</p>
<div class="codehilite"><pre><span class="nv">$ </span>ln -s <span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span> ../lib/python2.7/site-packages/<span class="sb">`</span>basename <span class="se">\`</span><span class="nb">pwd</span><span class="se">\`</span><span class="sb">`</span> 
<span class="nv">$ </span><span class="nb">export </span><span class="nv">DJANGO_SETTINGS_MODULE</span><span class="o">=</span>yourproject.settings
</pre></div>


<p>Add the previous line - <code>export DJANGO_SETTINGS_MODULE=yourproject.settings</code> - to the <code>~/domains/yourdomain.tld/.virtualenv/yourproject/bin/activate</code> file:</p>
<div class="codehilite"><pre><span class="nv">$ </span><span class="nb">echo</span> <span class="s2">&quot;!!&quot;</span> &gt;&gt; ../bin/activate
</pre></div>


<h2>Activate&nbsp;virtualenv</h2>
<div class="codehilite"><pre><span class="nv">$ </span><span class="nb">source</span> ~/domains/yourdomain.tld/.virtualenv/yourproject/bin/activate
</pre></div>


<h2>Install Django, then upload your application to the&nbsp;server</h2>
<div class="codehilite"><pre><span class="nv">$ </span>pip install django
<span class="nv">$ </span><span class="nb">cd</span> ~/domains/yourdomain.tld/web/
<span class="nv">$ </span>python django-admin.py startproject yourproject
</pre></div>


<p>This will have created the following folder layout under <code>~/domains/yourdomain.tld/web/</code>:</p>
<div class="codehilite"><pre>yourproject
    manage.py
    yourproject     <span class="o">&lt;-</span> default django app
</pre></div>


<p>Remove the latter yourproject folder (the default django app created by the startproject command) and replace it with your own project cloned from Github or elsewhere, since, like a good citizien, you are developing locally and only putting tested applications on the production server. Leave manage.py&nbsp;alone.</p>
<div class="codehilite"><pre><span class="nv">$ </span><span class="nb">cd</span> ~/domains/yourdomain.tld/web/yourproject/
<span class="nv">$ </span>rm -rf yourproject
<span class="nv">$ </span>git clone https://github.com/yourusername/yourproject/ yourproject
Initialized empty Git repository in /users/home/yourusername/domains/yourusername/web/yourproject
</pre></div>


<p><a href="http://stackoverflow.com/a/88331/412329">Set up your settings files for production (=<span class="caps">TODO</span>: Set up django-configurations)</a> and update the database settings to use your PostgreSQL or MySQL database if you are using those instead of sqlite3. If you use PostgreSQL or MySQL you need to create those first in&nbsp;virtualmin.</p>
<div class="codehilite"><pre><span class="nv"><span class="caps">DATABASES</span></span> <span class="o">=</span> <span class="o">{</span> 
    <span class="s1">&#39;default&#39;</span>: <span class="o">{</span> 
        <span class="s1">&#39;<span class="caps">ENGINE</span>&#39;</span>: <span class="s1">&#39;postgresql_psycopg2&#39;</span>, 
        <span class="s1">&#39;<span class="caps">NAME</span>&#39;</span>: <span class="s1">&#39;yourusername_django_mysite_database&#39;</span>, 
        <span class="s1">&#39;<span class="caps">USER</span>&#39;</span>: <span class="s1">&#39;yourusername&#39;</span>, 
        <span class="s1">&#39;<span class="caps">PASSWORD</span>&#39;</span>: <span class="s1">&#39;password&#39;</span>, 
        <span class="s1">&#39;<span class="caps">HOST</span>&#39;</span>: <span class="s1">&#39;localhost&#39;</span>, 
        <span class="s1">&#39;<span class="caps">PORT</span>&#39;</span>: <span class="s1">&#39;5432&#39;</span>, 
    <span class="o">}</span> 
<span class="o">}</span>
</pre></div>


<p>Try running <code>python manage.py syncdb</code>. If it works then your database is configured&nbsp;correctly.</p>
<h2>Install required software packages on the server with&nbsp;pip</h2>
<p>Let’s install the software packages from your application&#8217;s requirements.txt file (if you have&nbsp;one).</p>
<div class="codehilite"><pre><span class="nv">$ </span><span class="nb">cd</span> ~/domains/yourdomain.tld/web/yourproject/yourproject
<span class="nv">$ </span>pip install -r requirements.txt
</pre></div>


<h2>Setup static&nbsp;media</h2>
<p>Let’s assume you have some static media for your project in <code>~/domains/yourdomain.tld/web/yourproject/yourproject/static</code></p>
<p>For security reasons (but don’t trust me on this) we don’t want to serve static media (<span class="caps">CSS</span>, JavaScript, images) from inside our project directory. Instead, let’s create some other directories to serve static media&nbsp;from:</p>
<div class="codehilite"><pre><span class="nv">$ </span>mkdir -p ~/domains/yourdomain.tld/web/public/static
</pre></div>


<p>And then create a symbolic link from there to our media&nbsp;directory.</p>
<div class="codehilite"><pre><span class="nv">$ </span>ln -s ~/domains/yourdomain.tld/web/yourproject/yourproject/static/ ~/domains/yourdomain.tld/web/public/static
</pre></div>


<p>Now let’s link Django’s contrib.admin media to this location so that the static assets of Django&#8217;s admin app get served as&nbsp;well:</p>
<div class="codehilite"><pre><span class="nv">$ </span>ln -s ~/domains/yourdomain.tld/.virtualenv/yourproject/lib/python2.7/site-packages/django/contrib/admin/static/admin/ ~/domains/yourdomain.tld/web/yourproject/yourproject/static/admin
</pre></div>


<p>And lastly let’s configure settings.py (or settings_local.py depending on your project setup) to use these&nbsp;locations:</p>
<div class="codehilite"><pre><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">dirname</span><span class="p">,</span> <span class="n">join</span>
<span class="kn">from</span> <span class="nn">sys</span> <span class="kn">import</span> <span class="n">path</span>

<span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">dirname</span><span class="p">(</span><span class="n">__file__</span><span class="p">),</span> <span class="s">&quot;yourproject&quot;</span><span class="p">))</span>
<span class="n">PROJECT_ROOT</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">__file__</span><span class="p">))</span>

<span class="n">STATIC_URL</span> <span class="o">=</span> <span class="s">&#39;http://domain.tld/static/&#39;</span>
<span class="n">ADMIN_MEDIA_PREFIX</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PROJECT_ROOT</span><span class="p">,</span> <span class="s">&quot;admin/&quot;</span><span class="p">)</span>
</pre></div>


<h2>Setup NginX and&nbsp;FastCGI</h2>
<p>Create a directory to keep your nginx.conf file and the nginx.conf file&nbsp;itself:</p>
<div class="codehilite"><pre><span class="nv">$ </span>mkdir -p ~/yourdomain.tld/etc/nginx/sites-enabled 
<span class="nv">$ </span>vim ~/yourdomain.tld/etc/nginx/sites-enabled/nginx.conf
</pre></div>


<p><strong>=<span class="caps">TODO</span>: keep nginx conf in the project&#8217;s git repository and create symlink from sites-enabled to yourproject/conf/nginx.conf. This way we can keep the config in version&nbsp;control.</strong></p>
<p>Edit your nginx.conf file to look like the following but with your own port number<sup id="fnref:portnumber"><a class="footnote-ref" href="#fn:portnumber" rel="footnote">1</a></sup> (yourportnumber), domain (yourdomain.tld), and username&nbsp;(yourusername).</p>
<div class="codehilite"><pre><span class="c1"># http://stackoverflow.com/questions/13371925/how-to-turn-off-or-specify-the-nginx-error-log-location</span>
<span class="k">error_log</span> <span class="s">/dev/null</span> <span class="s">crit</span><span class="p">;</span>

<span class="k">worker_processes</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">pid</span> <span class="s">/users/home/yourusername/domains/yourdomain.tld/tmp/nginx.pid</span><span class="p">;</span>

<span class="k">events</span> <span class="p">{</span><span class="kn"> </span>
    <span class="s">worker_connections24</span><span class="p">;</span><span class="kn"> </span>
<span class="err">}</span>

<span class="s">http</span> <span class="p">{</span><span class="kn"> </span>
    <span class="s">include</span>     <span class="s">/opt/local/etc/nginx/mime.types</span><span class="p">;</span>

    <span class="kn">client_body_temp_path</span> <span class="s">/users/home/yourusername/domains/yourdomain.tld/var/spool/nginx/client_temp</span> <span class="mi">1</span> <span class="mi">2</span><span class="p">;</span>
    <span class="kn">proxy_temp_path</span> <span class="s">/users/home/yourusername/domains/yourdomain.tld/var/spool/nginx/proxy_temp</span> <span class="mi">1</span> <span class="mi">2</span><span class="p">;</span>
    <span class="kn">fastcgi_temp_path</span> <span class="s">/users/home/yourusername/domains/yourdomain.tld/var/spool/nginx/fstcgi_temp</span> <span class="mi">1</span> <span class="mi">2</span><span class="p">;</span><span class="kn"> </span>
    <span class="s">uwsgi_temp_path</span> <span class="s">/users/home/yourusername/domains/yourdomain.tld/var/spool/nginx/uwsgi_temp</span> <span class="mi">1</span> <span class="mi">2</span><span class="p">;</span><span class="kn"> </span>
    <span class="s">scgi_temp_path</span> <span class="s">/users/home/yourusername/domains/yourdomain.tld/var/spool/nginx/scgi_temp</span> <span class="mi">1</span> <span class="mi">2</span><span class="p">;</span>

    <span class="kn">log_format</span> <span class="s">main</span> <span class="s">&#39;</span><span class="nv">$remote_addr</span> <span class="s">-</span> <span class="nv">$remote_user</span> <span class="s">[</span><span class="nv">$time_local]</span> <span class="s">&#39;</span>
                  <span class="s">&#39;&quot;</span><span class="nv">$request&quot;</span> <span class="nv">$status$body_bytes_sent</span> <span class="s">&quot;</span><span class="nv">$http_referer&quot;</span> <span class="s">&#39;</span>
                  <span class="s">&#39;&quot;</span><span class="nv">$http_user_agent&quot;</span> <span class="s">&quot;</span><span class="nv">$http_x_forwarded_for&quot;&#39;</span><span class="p">;</span>
           <span class="kn"> </span>
    <span class="s">access_log</span> <span class="s">/users/home/yourusername/domains/yourdomain.tld/logs/nginx/nginx.access.log</span><span class="p">;</span>
    <span class="kn">error_log</span> <span class="s">/users/home/yourusername/domains/yourdomain.tld/logs/nginx/nginx.error.log</span><span class="p">;</span>

    <span class="kn">server</span> <span class="p">{</span><span class="kn"> </span>
        <span class="s">listen</span>       <span class="s">yourportnumber</span><span class="p">;</span><span class="kn"> </span>
        <span class="s">server_nameyourdomain.tld</span><span class="p">;</span><span class="kn"> </span>
        <span class="c1"># error_log /users/home/yourusername/domains/yourdomain.tld/logs/nginx-fcgi.error.log;</span>

        <span class="s">location</span> <span class="s">/static/files</span><span class="p">{</span>
            <span class="kn">alias</span> <span class="s">/users/home/yourusername/domains/yourdomain.tld/web/public/static/files</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="kn">location</span> <span class="s">/static</span> <span class="p">{</span>
            <span class="kn">alias</span> <span class="s">/users/home/yourusername/domains/yourdomain.tld/web/public/static</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="kn">location</span> <span class="s">/</span> <span class="p">{</span><span class="kn"> </span>
            <span class="s">fastcgi_pass</span> <span class="s">unix:/users/home/yourusername/domains/yourdomain.tld/web/yourproject/yourproject.socket</span><span class="p">;</span>

            <span class="c1"># fastcgi parameters </span>
            <span class="kn">fastcgi_param</span> <span class="s">PATH_INFO</span> <span class="nv">$fastcgi_script_name</span><span class="p">;</span><span class="kn"> </span>
            <span class="s">fastcgi_param</span> <span class="s">QUERY_STRING</span> <span class="nv">$query_string</span><span class="p">;</span><span class="kn"> </span>
            <span class="s">fastcgi_param</span> <span class="s">REQUEST_METHOD</span> <span class="nv">$request_method</span><span class="p">;</span><span class="kn"> </span>
            <span class="s">fastcgi_param</span> <span class="s">SERVER_PORT</span> <span class="nv">$server_port</span><span class="p">;</span><span class="kn"> </span>
            <span class="s">fastcgi_param</span> <span class="s">SERVER_PROTOCOL</span> <span class="nv">$server_protocol</span><span class="p">;</span><span class="kn"> </span>
            <span class="s">fastcgi_param</span> <span class="s">SERVER_NAME</span> <span class="nv">$server_name</span><span class="p">;</span><span class="kn"> </span>
            <span class="s">fastcgi_param</span> <span class="s">CONTENT_TYPE</span> <span class="nv">$content_type</span><span class="p">;</span><span class="kn"> </span>
            <span class="s">fastcgi_param</span> <span class="s">CONTENT_LENGTH</span> <span class="nv">$content_length</span><span class="p">;</span><span class="kn"> </span>
        <span class="err">}</span>  
    <span class="err">}</span><span class="s"> </span>
<span class="err">}</span>
</pre></div>


<p>Create an init.sh script in your project directory to start the Django FastCGI process that should look&nbsp;like:</p>
<div class="codehilite"><pre><span class="c">#!/usr/local/bin/bash</span>

<span class="c">#Activate the virtualenv </span>
<span class="nb">source</span> /users/home/yourusername/domains/yourdomain.tld/.virtualenv/yourproject/bin/activate

<span class="nv">PROJECT_NAME</span><span class="o">=</span><span class="s2">&quot;yourproject&quot;</span>
<span class="nv">PROJECT_DIR</span><span class="o">=</span><span class="s2">&quot;/users/home/yourusername/domains/yourdomain.tld/web/yourproject/yourproject&quot;</span> 
<span class="nv">PID_FILE</span><span class="o">=</span><span class="s2">&quot;/users/home/yourusername/domains/yourdomain.tld/web/yourproject/yourproject.pid&quot;</span> 
<span class="nv">SOCKET_FILE</span><span class="o">=</span><span class="s2">&quot;/users/home/yourusername/domains/yourdomain.tld/web/yourproject/yourproject.socket&quot;</span> 
<span class="nv">BIN_PYTHON</span><span class="o">=</span><span class="s2">&quot;/users/home/yourusername/domains/yourdomain.tld/.virtualenv/yourproject/bin/python&quot;</span> 
<span class="c"># DJANGO_ADMIN=&quot;/users/home/yourusername/domains/yourdomain.tld/.virtualenv/yourproject/bin/django-admin.py&quot; </span>
<span class="nv"><span class="caps">MANAGE</span></span><span class="o">=</span><span class="s2">&quot;/users/home/yourusername/domains/yourdomain.tld/web/yourproject/manage.py&quot;</span> 
<span class="nv"><span class="caps">OPTIONS</span></span><span class="o">=</span><span class="s2">&quot;maxchildren=2 maxspare=2 minspare=1&quot;</span>
<span class="nv"><span class="caps">METHOD</span></span><span class="o">=</span><span class="s2">&quot;prefork&quot;</span>

<span class="k">case</span> <span class="s2">&quot;$1&quot;</span> in
    start<span class="o">)</span> 
      <span class="c"># Starts the Django process </span>
      <span class="nb">echo</span> <span class="s2">&quot;Starting Django project&quot;</span> 
      <span class="c"># $BIN_PYTHON $DJANGO_ADMIN runfcgi $<span class="caps">OPTIONS</span> method=$<span class="caps">METHOD</span> socket=$SOCKET_FILE pidfile=$PID_FILE </span>
      <span class="nv">$BIN_PYTHON</span> <span class="nv">$<span class="caps">MANAGE</span></span> runfcgi <span class="nv">$<span class="caps">OPTIONS</span></span> <span class="nv">method</span><span class="o">=</span><span class="nv">$<span class="caps">METHOD</span></span> <span class="nv">socket</span><span class="o">=</span><span class="nv">$SOCKET_FILE</span> <span class="nv">pidfile</span><span class="o">=</span><span class="nv">$PID_FILE</span> 
  ;;
    stop<span class="o">)</span> 
      <span class="c"># stops the daemon by cating the pidfile </span>
      <span class="nb">echo</span> <span class="s2">&quot;Stopping Django project&quot;</span> 
      <span class="nb">kill</span> <span class="sb">`</span>/bin/cat <span class="nv">$PID_FILE</span><span class="sb">`</span> 
  ;;
    restart<span class="o">)</span> 
      <span class="c">## Stop the service regardless of whether it was </span>
      <span class="c">## running or not, start it again. </span>
      <span class="nb">echo</span> <span class="s2">&quot;Restarting process&quot;</span> 
      <span class="nv">$0</span> stop
      <span class="nv">$0</span> start
  ;;
    *<span class="o">)</span>
      <span class="nb">echo</span> <span class="s2">&quot;Usage: init.sh (start|stop|restart)&quot;</span> 
      <span class="nb">exit </span>1
  ;;
<span class="k">esac</span>
</pre></div>


<h3>Make this init.sh file&nbsp;executable:</h3>
<div class="codehilite"><pre><span class="nv">$ </span>chmod +x /users/home/yourusername/domains/yourdomain.tld/web/yourproject/init.sh
</pre></div>


<h3>Start Django FastCGI instance&nbsp;with:</h3>
<div class="codehilite"><pre><span class="nv">$ </span>/users/home/yourusername/domains/yourdomain.tld/web/yourproject/init.sh start
</pre></div>


<p>This script also takes stop, and restart as&nbsp;parameters.</p>
<h3>Start Nginx with your configuration&nbsp;file:</h3>
<div class="codehilite"><pre><span class="nv">$ </span>/usr/local/sbin/nginx -p /users/home/yourusername/ -c /users/home/yourusername/domains/yourdomain.tld/etc/nginx/sites-enabled/nginx.conf
</pre></div>


<p>The Django application should now be running at http://domain.tld:<span class="caps">PORTNUBMER</span>/. Don&#8217;t forget to log in and go to http://domain.tld:<span class="caps">PORTNUBMER</span>/admin/sites/site/ and set the domain&nbsp;name.</p>
<h2>Create a ProxyPath and ProxyPathReverse from http://domain.tld:<span class="caps">PORTNUMBER</span> to&nbsp;http://domain.tld</h2>
<ol>
<li>Log into your txd account through virtualmin&nbsp;(https://virtualmin-yourserverlocationid.textdrive.us/yourserver/)</li>
<li>Under &#8220;Server Configuration&#8221; click on &#8220;Proxy&nbsp;Paths&#8221;</li>
<li>Click &#8220;Add a new proxy&nbsp;path.&#8221;</li>
<li>Enter &#8220;/&#8221; for the &#8220;Local <span class="caps">URL</span>&nbsp;path&#8221;</li>
<li>Enter &#8220;http://127.0.0.1:yourportnumber&#8221; for the &#8220;Destination&nbsp;<span class="caps">URL</span>&#8221;.</li>
<li>Click&nbsp;&#8220;Save&#8221;</li>
</ol>
<p>ProxyPassReverse:</p>
<ol>
<li>Click&nbsp;&#8220;Services&#8221;</li>
<li>Click &#8220;Configure&nbsp;website&#8221;</li>
<li>Click &#8220;Show&nbsp;Directives&#8221;</li>
<li>From the drop down list chose&nbsp;&#8220;ProxyPassReverse&#8221;</li>
<li>Find the heading &#8220;Map remote Location: headers to&nbsp;local&#8221;</li>
<li>For &#8220;Local <span class="caps">URL</span> Path&#8221; add&nbsp;&#8221;/&#8221;</li>
<li>For &#8220;Remote <span class="caps">URL</span>&#8221; add&nbsp;&#8220;balancer://root/&#8221;</li>
</ol>
<p><span class="caps">NOTE</span>: the balancer name should be the same as the one entered for &#8220;Remote <span class="caps">URL</span>&#8221; under &#8220;Map local to remote&nbsp;URLs&#8221;.</p>
<p>=<span class="caps">TODO</span>: create bootup actions in virtualmin to start the Django FastCGI process and NginX on server&nbsp;reboots.</p>
<h2>Stopping&nbsp;Nginx</h2>
<div class="codehilite"><pre><span class="nv">$ </span>ps -ef | grep nginx | awk <span class="s1">&#39;{print $2}&#39;</span>| xargs <span class="nb">kill</span> -9
</pre></div>


<p>or</p>
<div class="codehilite"><pre><span class="nv">$ </span>/usr/local/sbin/nginx -s stop -p /users/home/yourusername/ -c /users/home/yourusername/domains/yourdomain.tld/etc/nginx/sites-enabled/nginx.conf
</pre></div>


<h2>Stopping fcgi (whenever you update your application you need to stop and then start&nbsp;fcgi)</h2>
<div class="codehilite"><pre><span class="nv">$ </span>. init.sh stop
</pre></div>


<h2>Todo:</h2>
<p>Set up <a href="http://docs.fabfile.org/">fabric</a> script to automate&nbsp;deployment.</p>
<div class="footnote">
<hr />
<ol>
<li id="fn:portnumber">
<p>To find a free port number you can use for your account, log into your Textdrive account via virtualmin, then click <em>Other Tools</em> and <em>Check Ports</em>.&#160;<a class="footnote-backref" href="#fnref:portnumber" rev="footnote" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
</ol>
</div>

  <p id="about">
    A <a href="/" title="Home.">Hypertexthero</a></b> article by <a href="http://simongriffee.com" title="See my photography website.">Simon Griffee</a> published on <a title="Permanent link to this entry." href="/logbook/2013/05/textdrive-server-deployment-nginx-fastcgi/"><time pubdate="pubdate">05 May 2013</time></a> under a <a href="http://creativecommons.org/licenses/by/3.0/">Creative Commons License</a>. See more articles in the <a href="/archive/" title="Archive of original logbook entries.">archive</a>. Links are in the <a href="/linked/" title="List of links to other places on the internet that Hypertexthero finds interesting.">linked list</a>.
  </p>

 




<p class="paging">
  
  
    <a rel="prev" href="/logbook/2013/05/running-notes-getting-django-setup-nginx-and-uwsgi/"><i>Previous entry:</i> <b>Running Notes on Getting Django Setup with Nginx and uWSGI</b></a>
  
    <br>
  
    <a rel="next" href="/logbook/2013/05/zoom-lenses/"><i>Next entry:</i> <b>Zoom Lenses</b></a>
  
</p>

  </div> 

  <div id="footer">
    
    <form method="get" id="search" action="http://duckduckgo.com/">
    <input type="hidden" name="sites" value="hypertexthero.com"/>
    <input type="hidden" name="k8" value="#444444"/>
    <input type="hidden" name="k9" value="#D51920"/>
    <input type="hidden" name="kt" value="h"/>
    <input type="text" name="q" maxlength="255" placeholder=""/>
    <input id="searchbutton" type="submit" value="Search" />
</form>

    
    
    
    <p class="small">
      
      
      
      
      
    </p>
    
    
</div> 
</div> 
</div> 
<script src="/static/js/jquery-1.9.1.min.js"></script>



</body>
</html>
